import { WebSocketServer } from "ws";
import axios from "axios";
import dayjs from "dayjs";

const mockPort = 8082;
console.log(`listening on port ${mockPort} before connecting to polygon`);
const wss = new WebSocketServer({ port: mockPort });
const APIKEY = process.env.POLYGON_APIKEY;
const aggUrl = ({ symbol, date }) =>
  `https://api.polygon.io/v2/aggs/ticker/${symbol}/range/1/second/${date}/${date}?adjusted=true&sort=asc&limit=50000&apiKey=${APIKEY}`;

const getHistoricalData = async ({ symbol, date }) => {
  const response = await axios.get(aggUrl({ symbol, date }));
  return { symbol, data: response.data.results };
};

const parseData = (d, symbol) => {
  return {
    type: "TXN",
    ts: d.t,
    time: dayjs(d.t).format("HH:mm"),
    symbol,
    open: d.o,
    high: d.h,
    low: d.l,
    close: d.c,
    volume: d.v,
  };
};

const sortByTime = (a, b) => {
  const aTime = dayjs(a.ts);
  const bTime = dayjs(b.ts);
  if (aTime.isBefore(bTime)) {
    return -1;
  }
  if (aTime.isAfter(bTime)) {
    return 1;
  }
  return 0;
};

wss.on("connection", async function connection(ws) {
  console.log("Historical web socket 8082 started");

  const data = dummyData();
  const total = data.data.length;
  let i = 0;

  setInterval(() => {
    const next = i % total;
    i++;
    const sendData = data.data[next];

    ws.send(JSON.stringify(sendData));
  }, 100);

  let stocks = [];
  let stocksInterval = null;
  let intervalData = [];

  ws.on("message", async (data) => {
    const { date, symbols } = JSON.parse(data.toString("utf8"));
    stocks.push(...symbols);
    clearInterval(stocksInterval);

    const promises = symbols.map(async ({ symbol }) => {
      return getHistoricalData({ symbol, date });
    });
    const historicalData = await Promise.all(promises);
    historicalData.forEach((stock) => {
      const { symbol, data } = stock;
      const stockData = data.map((d) => parseData(d, symbol));
      if (stockData.length > 0) {
        const sortedData = stockData.sort(sortByTime);
        intervalData.push(sortedData);
      }
    });

    intervalData.forEach((stock) => {
      let [hour, minute] = dayjs(stock[0].ts).format("HH:mm").split(":");

      const [fastForwardHour, fastforwardMinute] = symbols
        .find((s) => s.symbol === stock[0].symbol)
        ?.time?.split(":");

      while (Number.parseInt(hour) < fastForwardHour) {
        const d = stock.shift();
        [hour] = dayjs(d.ts).format("HH:mm").split(":");
        console.log("removing data", d.time, hour);
      }
      while (Number.parseInt(minute) <= fastforwardMinute) {
        const d = stock.shift();
        [, minute] = dayjs(d.ts).format("HH:mm").split(":");
        console.log("removing data", d.time, minute);
      }
    });

    console.log("starting interval");
    stocksInterval = setInterval(() => {
      intervalData.forEach((stock) => {
        console.log("stock", stock.length);

        const d = stock.shift();
        if (d && d.ts) {
          const testTime = dayjs(d.ts).format("MM-DD-YYYY HH:mm:ss");
          console.log("sending data", d.time, testTime);
          ws.send(JSON.stringify(d));
        }
      });
    }, 1000);
  });

  wss.on("close", () => {
    console.log("Client disconnected");
  });

  wss.onerror = function () {
    console.log("Some Error occurred");
  };
});

const dummyData = () => {
  return {
    data: [
      {
        type: "TXN",
        open: 72,
        close: 72,
        high: 72,
        low: 72,
        aveVolWeightedPrice: 72,
        time: "08:32",
        symbol: "NKE",
        volume: 1167137,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 415.77,
        close: 415.8,
        high: 415.8,
        low: 415.72,
        aveVolWeightedPrice: 415.8359,
        time: "08:34",
        symbol: "TSLA",
        volume: 7420974,
        ts: 1734701671000,
      },
      {
        type: "TXN",
        open: 416.229,
        close: 415.9243,
        high: 416.29,
        low: 415.9243,
        aveVolWeightedPrice: 416.1048,
        time: "08:34",
        symbol: "TSLA",
        volume: 7523181,
        ts: 1734701672000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 416,
        high: 416,
        low: 415.98,
        aveVolWeightedPrice: 415.9975,
        time: "08:34",
        symbol: "TSLA",
        volume: 7624616,
        ts: 1734701673000,
      },
      {
        type: "TXN",
        open: 416.0001,
        close: 416,
        high: 416.2889,
        low: 416,
        aveVolWeightedPrice: 416.0278,
        time: "08:34",
        symbol: "TSLA",
        volume: 7827555,
        ts: 1734701674000,
      },
      {
        type: "TXN",
        open: 416.15,
        close: 416.5,
        high: 416.5,
        low: 416.1003,
        aveVolWeightedPrice: 416.2884,
        time: "08:34",
        symbol: "TSLA",
        volume: 7416797,
        ts: 1734701675000,
      },
      {
        type: "TXN",
        open: 1.5,
        close: 1.5,
        high: 1.5,
        low: 1.5,
        aveVolWeightedPrice: 1.4998,
        time: "08:32",
        symbol: "UK",
        volume: 2992975,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 40,
        close: 40.01,
        high: 40.01,
        low: 40,
        aveVolWeightedPrice: 40.0036,
        time: "08:32",
        symbol: "SMCX",
        volume: 145671,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 509.739,
        close: 509.739,
        high: 509.739,
        low: 509.739,
        aveVolWeightedPrice: 509.6999,
        time: "08:32",
        symbol: "QQQ",
        volume: 1669870,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 30.6,
        close: 30.54,
        high: 30.62,
        low: 30.54,
        aveVolWeightedPrice: 30.5943,
        time: "08:32",
        symbol: "SMCI",
        volume: 1396777,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 117.68,
        close: 117.69,
        high: 117.69,
        low: 117.68,
        aveVolWeightedPrice: 117.683,
        time: "08:32",
        symbol: "AMD",
        volume: 932057,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 7.9,
        close: 7.9,
        high: 7.9,
        low: 7.9,
        aveVolWeightedPrice: 7.9,
        time: "08:32",
        symbol: "SMST",
        volume: 3473702,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 5.78,
        close: 5.78,
        high: 5.78,
        low: 5.78,
        aveVolWeightedPrice: 5.78,
        time: "08:32",
        symbol: "QBTS",
        volume: 6294372,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 12.2,
        close: 12.2,
        high: 12.2,
        low: 12.2,
        aveVolWeightedPrice: 12.2,
        time: "08:32",
        symbol: "GRRR",
        volume: 109306,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 4.48,
        close: 4.48,
        high: 4.48,
        low: 4.48,
        aveVolWeightedPrice: 4.48,
        time: "08:32",
        symbol: "NIO",
        volume: 1671032,
        ts: 1734701542000,
      },

      {
        type: "TXN",
        open: 5.46,
        close: 5.47,
        high: 5.47,
        low: 5.46,
        aveVolWeightedPrice: 5.4642,
        time: "08:32",
        symbol: "UVIX",
        volume: 6181786,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 1.97,
        close: 1.97,
        high: 1.99,
        low: 1.97,
        aveVolWeightedPrice: 1.9808,
        time: "08:32",
        symbol: "BNZI",
        volume: 266566,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 31.03,
        close: 31.03,
        high: 31.0301,
        low: 31.03,
        aveVolWeightedPrice: 31.0305,
        time: "08:32",
        symbol: "TSLL",
        volume: 16044173,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 7.57,
        close: 7.5688,
        high: 7.5788,
        low: 7.565,
        aveVolWeightedPrice: 7.57,
        time: "08:32",
        symbol: "ETHU",
        volume: 14992717,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 177.19,
        close: 177.19,
        high: 177.19,
        low: 177.19,
        aveVolWeightedPrice: 177.19,
        time: "08:32",
        symbol: "BA",
        volume: 172431,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 32.42,
        close: 32.41,
        high: 32.42,
        low: 32.41,
        aveVolWeightedPrice: 32.4167,
        time: "08:32",
        symbol: "SQQQ",
        volume: 5416761,
        ts: 1734701542000,
      },
      {
        type: "TXN",
        open: 75.04,
        close: 75.04,
        high: 75.04,
        low: 75.04,
        aveVolWeightedPrice: 75.04,
        time: "08:32",
        symbol: "GBTC",
        volume: 86080,
        ts: 1734701542000,
      },

      {
        type: "TXN",
        open: 416.8,
        close: 416.8,
        high: 416.97,
        low: 416.8,
        aveVolWeightedPrice: 416.8906,
        time: "08:33",
        symbol: "TSLA",
        volume: 7336852,
        ts: 1734701638000,
      },
      {
        type: "TXN",
        open: 416.99,
        close: 416.99,
        high: 416,
        low: 416.8638,
        aveVolWeightedPrice: 416.9687,
        time: "08:33",
        symbol: "TSLA",
        volume: 7338935,
        ts: 1734701639000,
      },
      {
        type: "TXN",
        open: 416.92,
        close: 416.15,
        high: 416.15,
        low: 416.92,
        aveVolWeightedPrice: 416.0397,
        time: "08:34",
        symbol: "TSLA",
        volume: 7346500,
        ts: 1734701640000,
      },
      {
        type: "TXN",
        open: 416.25,
        close: 416.9,
        high: 416.58,
        low: 416.9,
        aveVolWeightedPrice: 416.2504,
        time: "08:34",
        symbol: "TSLA",
        volume: 7351093,
        ts: 1734701641500,
      },
      {
        type: "TXN",
        open: 416.9,
        close: 416.16,
        high: 416.34,
        low: 416.8993,
        aveVolWeightedPrice: 416.1242,
        time: "08:34",
        symbol: "TSLA",
        volume: 7852403,
        ts: 1734701642000,
      },
      {
        type: "TXN",
        open: 416.92,
        close: 416.324,
        high: 416.324,
        low: 416.92,
        aveVolWeightedPrice: 416.064,
        time: "08:34",
        symbol: "TSLA",
        volume: 7953147,
        ts: 1734701643000,
      },
      {
        type: "TXN",
        open: 416.25,
        close: 416.25,
        high: 416.25,
        low: 416.25,
        aveVolWeightedPrice: 416.1774,
        time: "08:34",
        symbol: "TSLA",
        volume: 10353696,
        ts: 1734701644000,
      },
      {
        type: "TXN",
        open: 416.25,
        close: 416.95,
        high: 416.25,
        low: 416.95,
        aveVolWeightedPrice: 416.1363,
        time: "08:34",
        symbol: "TSLA",
        volume: 10554508,
        ts: 1734701645000,
      },
      {
        type: "TXN",
        open: 416.328,
        close: 416.0025,
        high: 416.33,
        low: 416.0025,
        aveVolWeightedPrice: 416.1009,
        time: "08:34",
        symbol: "TSLA",
        volume: 7356095,
        ts: 1734701646000,
      },
      {
        type: "TXN",
        open: 416.29,
        close: 416,
        high: 416.34,
        low: 416,
        aveVolWeightedPrice: 416.1253,
        time: "08:34",
        symbol: "TSLA",
        volume: 7360741,
        ts: 1734701647000,
      },
      {
        type: "TXN",
        open: 416.22,
        close: 416.06,
        high: 416.22,
        low: 416.06,
        aveVolWeightedPrice: 416.1376,
        time: "08:34",
        symbol: "TSLA",
        volume: 7361506,
        ts: 1734701648000,
      },
      {
        type: "TXN",
        open: 416.1,
        close: 416,
        high: 416.1,
        low: 416,
        aveVolWeightedPrice: 416.0679,
        time: "08:34",
        symbol: "TSLA",
        volume: 7362366,
        ts: 1734701649000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416,
        high: 416.01,
        low: 416,
        aveVolWeightedPrice: 416.0595,
        time: "08:34",
        symbol: "TSLA",
        volume: 7363667,
        ts: 1734701650000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416,
        high: 416.01,
        low: 416,
        aveVolWeightedPrice: 416.0239,
        time: "08:34",
        symbol: "TSLA",
        volume: 7367523,
        ts: 1734701651000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.77,
        high: 416,
        low: 416.77,
        aveVolWeightedPrice: 416.9037,
        time: "08:34",
        symbol: "TSLA",
        volume: 7375431,
        ts: 1734701652000,
      },
      {
        type: "TXN",
        open: 416.77,
        close: 416.68,
        high: 416,
        low: 416.68,
        aveVolWeightedPrice: 416.8104,
        time: "08:34",
        symbol: "TSLA",
        volume: 7380422,
        ts: 1734701653000,
      },
      {
        type: "TXN",
        open: 416.6,
        close: 416.5921,
        high: 416.64,
        low: 416.49,
        aveVolWeightedPrice: 416.5703,
        time: "08:34",
        symbol: "TSLA",
        volume: 7384167,
        ts: 1734701654000,
      },
      {
        type: "TXN",
        open: 416.6,
        close: 416.4446,
        high: 416.6,
        low: 416.33,
        aveVolWeightedPrice: 416.4162,
        time: "08:34",
        symbol: "TSLA",
        volume: 7389822,
        ts: 1734701655000,
      },
      {
        type: "TXN",
        open: 416.2901,
        close: 416.2901,
        high: 416.2901,
        low: 416.2901,
        aveVolWeightedPrice: 416.3177,
        time: "08:34",
        symbol: "TSLA",
        volume: 7390843,
        ts: 1734701656000,
      },
      {
        type: "TXN",
        open: 416.39,
        close: 416.29,
        high: 416.39,
        low: 416,
        aveVolWeightedPrice: 416.195,
        time: "08:34",
        symbol: "TSLA",
        volume: 7394028,
        ts: 1734701657000,
      },
      {
        type: "TXN",
        open: 415.89,
        close: 416.14,
        high: 416.27,
        low: 415.87,
        aveVolWeightedPrice: 416.0286,
        time: "08:34",
        symbol: "TSLA",
        volume: 7395743,
        ts: 1734701658000,
      },
      {
        type: "TXN",
        open: 415.87,
        close: 415.85,
        high: 415.87,
        low: 415.85,
        aveVolWeightedPrice: 415.8851,
        time: "08:34",
        symbol: "TSLA",
        volume: 7397784,
        ts: 1734701659000,
      },
      {
        type: "TXN",
        open: 416.04,
        close: 416.0001,
        high: 416.2772,
        low: 416,
        aveVolWeightedPrice: 416.0752,
        time: "08:34",
        symbol: "TSLA",
        volume: 7399125,
        ts: 1734701660000,
      },
      {
        type: "TXN",
        open: 416.159,
        close: 416.01,
        high: 416.159,
        low: 416.0016,
        aveVolWeightedPrice: 416.0216,
        time: "08:34",
        symbol: "TSLA",
        volume: 7401335,
        ts: 1734701661000,
      },
      {
        type: "TXN",
        open: 416.01,
        close: 415.98,
        high: 416.01,
        low: 415.98,
        aveVolWeightedPrice: 416.0021,
        time: "08:34",
        symbol: "TSLA",
        volume: 7403846,
        ts: 1734701662000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 415.87,
        high: 416,
        low: 415.84,
        aveVolWeightedPrice: 415.9544,
        time: "08:34",
        symbol: "TSLA",
        volume: 7406566,
        ts: 1734701663000,
      },
      {
        type: "TXN",
        open: 415.76,
        close: 415.98,
        high: 415.98,
        low: 415.76,
        aveVolWeightedPrice: 415.8792,
        time: "08:34",
        symbol: "TSLA",
        volume: 7407006,
        ts: 1734701664000,
      },
      {
        type: "TXN",
        open: 415.75,
        close: 415.83,
        high: 415.83,
        low: 415.75,
        aveVolWeightedPrice: 415.7904,
        time: "08:34",
        symbol: "TSLA",
        volume: 7409103,
        ts: 1734701665000,
      },
      {
        type: "TXN",
        open: 415.78,
        close: 415.83,
        high: 415.84,
        low: 415.53,
        aveVolWeightedPrice: 415.7462,
        time: "08:34",
        symbol: "TSLA",
        volume: 7415275,
        ts: 1734701666000,
      },
      {
        type: "TXN",
        open: 415.96,
        close: 415.72,
        high: 416,
        low: 415.72,
        aveVolWeightedPrice: 415.9544,
        time: "08:34",
        symbol: "TSLA",
        volume: 7416917,
        ts: 1734701668000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.161,
        high: 416.23,
        low: 415.86,
        aveVolWeightedPrice: 416.0419,
        time: "08:34",
        symbol: "TSLA",
        volume: 7416189,
        ts: 1734701669000,
      },
      {
        type: "TXN",
        open: 416.11,
        close: 416.01,
        high: 416.19,
        low: 416.01,
        aveVolWeightedPrice: 416.086,
        time: "08:34",
        symbol: "TSLA",
        volume: 7418493,
        ts: 1734701670000,
      },
      {
        type: "TXN",
        open: 416.1309,
        close: 416.1309,
        high: 416.1309,
        low: 416.1309,
        aveVolWeightedPrice: 416.1648,
        time: "08:34",
        symbol: "TSLA",
        volume: 7430653,
        ts: 1734701678000,
      },
      {
        type: "TXN",
        open: 416.39,
        close: 416.45,
        high: 416.48,
        low: 416.39,
        aveVolWeightedPrice: 416.4091,
        time: "08:34",
        symbol: "TSLA",
        volume: 7432154,
        ts: 1734701679000,
      },
      {
        type: "TXN",
        open: 416.28,
        close: 416.2797,
        high: 416.28,
        low: 416.27,
        aveVolWeightedPrice: 416.2469,
        time: "08:34",
        symbol: "TSLA",
        volume: 7433278,
        ts: 1734701680000,
      },
      {
        type: "TXN",
        open: 416.1308,
        close: 416,
        high: 416.17,
        low: 415.99,
        aveVolWeightedPrice: 416.1114,
        time: "08:34",
        symbol: "TSLA",
        volume: 7437623,
        ts: 1734701681000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.08,
        high: 416.08,
        low: 415.87,
        aveVolWeightedPrice: 416.0059,
        time: "08:34",
        symbol: "TSLA",
        volume: 7439974,
        ts: 1734701682000,
      },
      {
        type: "TXN",
        open: 416.02,
        close: 416.08,
        high: 416.08,
        low: 416.01,
        aveVolWeightedPrice: 416.0243,
        time: "08:34",
        symbol: "TSLA",
        volume: 7441650,
        ts: 1734701683000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416,
        high: 416,
        low: 416,
        aveVolWeightedPrice: 415.86,
        time: "08:34",
        symbol: "TSLA",
        volume: 7441935,
        ts: 1734701685000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.03,
        high: 416.03,
        low: 415.9,
        aveVolWeightedPrice: 415.9611,
        time: "08:34",
        symbol: "TSLA",
        volume: 7444161,
        ts: 1734701686000,
      },
      {
        type: "TXN",
        open: 415.86,
        close: 415.86,
        high: 415.86,
        low: 415.86,
        aveVolWeightedPrice: 415.9324,
        time: "08:34",
        symbol: "TSLA",
        volume: 7444449,
        ts: 1734701687000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 415.49,
        high: 415.98,
        low: 415.49,
        aveVolWeightedPrice: 415.6187,
        time: "08:34",
        symbol: "TSLA",
        volume: 7448042,
        ts: 1734701688000,
      },
      {
        type: "TXN",
        open: 415.49,
        close: 415.48,
        high: 415.49,
        low: 415.48,
        aveVolWeightedPrice: 415.4983,
        time: "08:34",
        symbol: "TSLA",
        volume: 7449416,
        ts: 1734701689000,
      },
      {
        type: "TXN",
        open: 415.6887,
        close: 415.39,
        high: 415.6887,
        low: 415.39,
        aveVolWeightedPrice: 415.4811,
        time: "08:34",
        symbol: "TSLA",
        volume: 7450726,
        ts: 1734701690000,
      },
      {
        type: "TXN",
        open: 415.2163,
        close: 415.2,
        high: 415.23,
        low: 415.2,
        aveVolWeightedPrice: 415.2379,
        time: "08:34",
        symbol: "TSLA",
        volume: 7452657,
        ts: 1734701691000,
      },
      {
        type: "TXN",
        open: 415.29,
        close: 415.29,
        high: 415.29,
        low: 415.29,
        aveVolWeightedPrice: 415.2505,
        time: "08:34",
        symbol: "TSLA",
        volume: 7453031,
        ts: 1734701692000,
      },
      {
        type: "TXN",
        open: 415.37,
        close: 415.4199,
        high: 415.42,
        low: 415.36,
        aveVolWeightedPrice: 415.3868,
        time: "08:34",
        symbol: "TSLA",
        volume: 7458339,
        ts: 1734701693000,
      },
      {
        type: "TXN",
        open: 415.33,
        close: 415.3,
        high: 415.33,
        low: 415.3,
        aveVolWeightedPrice: 415.3272,
        time: "08:34",
        symbol: "TSLA",
        volume: 7460224,
        ts: 1734701694000,
      },
      {
        type: "TXN",
        open: 415.42,
        close: 415.42,
        high: 415.45,
        low: 415.42,
        aveVolWeightedPrice: 415.4046,
        time: "08:34",
        symbol: "TSLA",
        volume: 7462391,
        ts: 1734701695000,
      },
      {
        type: "TXN",
        open: 415.255,
        close: 415.2,
        high: 415.42,
        low: 415.2,
        aveVolWeightedPrice: 415.3053,
        time: "08:34",
        symbol: "TSLA",
        volume: 7463731,
        ts: 1734701696000,
      },
      {
        type: "TXN",
        open: 415.2,
        close: 415.02,
        high: 415.2,
        low: 415.02,
        aveVolWeightedPrice: 415.1394,
        time: "08:34",
        symbol: "TSLA",
        volume: 7465212,
        ts: 1734701697000,
      },
      {
        type: "TXN",
        open: 415.01,
        close: 415.31,
        high: 415.31,
        low: 415.01,
        aveVolWeightedPrice: 415.1762,
        time: "08:34",
        symbol: "TSLA",
        volume: 7466280,
        ts: 1734701698000,
      },
      {
        type: "TXN",
        open: 415.0182,
        close: 415.01,
        high: 415.0182,
        low: 415.01,
        aveVolWeightedPrice: 415.0416,
        time: "08:34",
        symbol: "TSLA",
        volume: 7467392,
        ts: 1734701699000,
      },
      {
        type: "TXN",
        open: 415.1981,
        close: 415.34,
        high: 415.42,
        low: 415.1981,
        aveVolWeightedPrice: 415.2458,
        time: "08:35",
        symbol: "TSLA",
        volume: 7472002,
        ts: 1734701700000,
      },
      {
        type: "TXN",
        open: 415.3,
        close: 415.27,
        high: 415.52,
        low: 415.27,
        aveVolWeightedPrice: 415.3673,
        time: "08:35",
        symbol: "TSLA",
        volume: 7474162,
        ts: 1734701701000,
      },
      {
        type: "TXN",
        open: 415.66,
        close: 415.52,
        high: 415.67,
        low: 415.45,
        aveVolWeightedPrice: 415.5924,
        time: "08:35",
        symbol: "TSLA",
        volume: 7475790,
        ts: 1734701702000,
      },
      {
        type: "TXN",
        open: 415.68,
        close: 415.74,
        high: 415.74,
        low: 415.68,
        aveVolWeightedPrice: 415.7245,
        time: "08:35",
        symbol: "TSLA",
        volume: 7476741,
        ts: 1734701703000,
      },
      {
        type: "TXN",
        open: 415.6756,
        close: 415.95,
        high: 415.98,
        low: 415.6756,
        aveVolWeightedPrice: 415.8287,
        time: "08:35",
        symbol: "TSLA",
        volume: 7478775,
        ts: 1734701704000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 415.98,
        high: 415.98,
        low: 415.98,
        aveVolWeightedPrice: 415.9487,
        time: "08:35",
        symbol: "TSLA",
        volume: 7478981,
        ts: 1734701705000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 415.83,
        high: 415.98,
        low: 415.83,
        aveVolWeightedPrice: 415.8708,
        time: "08:35",
        symbol: "TSLA",
        volume: 7479819,
        ts: 1734701706000,
      },
      {
        type: "TXN",
        open: 415.67,
        close: 415.67,
        hih: 415.67,
        low: 415.67,
        aveVolWeightedPrice: 415.6354,
        time: "08:35",
        symbol: "TSLA",
        volume: 7481548,
        ts: 1734701708000,
      },
      {
        type: "TXN",
        open: 415.47,
        close: 415.33,
        high: 415.48,
        low: 415.33,
        aveVolWeightedPrice: 415.4095,
        time: "08:35",
        symbol: "TSLA",
        volume: 7483283,
        ts: 1734701709000,
      },
      {
        type: "TXN",
        open: 415.4,
        close: 415.4,
        high: 415.4,
        low: 415.4,
        aveVolWeightedPrice: 415.4359,
        time: "08:35",
        symbol: "TSLA",
        volume: 7483747,
        ts: 1734701710000,
      },
      {
        type: "TXN",
        open: 415.5,
        close: 415.536,
        high: 415.536,
        low: 415.5,
        aveVolWeightedPrice: 415.5508,
        time: "08:35",
        symbol: "TSLA",
        volume: 7485143,
        ts: 1734701713000,
      },
      {
        type: "TXN",
        open: 415.5001,
        close: 415.5001,
        high: 415.5001,
        low: 415.5001,
        aveVolWeightedPrice: 415.5488,
        time: "08:35",
        symbol: "TSLA",
        volume: 7485844,
        ts: 1734701716000,
      },
      {
        type: "TXN",
        open: 415.66,
        close: 415.66,
        high: 415.66,
        low: 415.66,
        aveVolWeightedPrice: 415.6191,
        time: "08:35",
        symbol: "TSLA",
        volume: 7486234,
        ts: 1734701717000,
      },
      {
        type: "TXN",
        open: 415.66,
        close: 415.66,
        high: 415.66,
        low: 415.66,
        aveVolWeightedPrice: 415.6583,
        time: "08:35",
        symbol: "TSLA",
        volume: 7486918,
        ts: 1734701718000,
      },
      {
        type: "TXN",
        open: 415.52,
        close: 415.52,
        high: 415.52,
        low: 415.52,
        aveVolWeightedPrice: 415.5629,
        time: "08:35",
        symbol: "TSLA",
        volume: 7487580,
        ts: 1734701719000,
      },
      {
        type: "TXN",
        open: 415.6,
        close: 415.6,
        high: 415.6,
        low: 415.6,
        aveVolWeightedPrice: 415.6273,
        time: "08:35",
        symbol: "TSLA",
        volume: 7488044,
        ts: 1734701720000,
      },
      {
        type: "TXN",
        open: 415.591,
        close: 415.591,
        high: 415.591,
        low: 415.591,
        aveVolWeightedPrice: 415.6381,
        time: "08:35",
        symbol: "TSLA",
        volume: 7488252,
        ts: 1734701721000,
      },
      {
        type: "TXN",
        open: 415.5,
        close: 415.5183,
        high: 415.5183,
        low: 415.5,
        aveVolWeightedPrice: 415.6096,
        time: "08:35",
        symbol: "TSLA",
        volume: 7488737,
        ts: 1734701722000,
      },
      {
        type: "TXN",
        open: 415.8,
        close: 415.9,
        high: 415.9,
        low: 415.8,
        aveVolWeightedPrice: 415.8004,
        time: "08:35",
        symbol: "TSLA",
        volume: 7489589,
        ts: 1734701723000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 415.9797,
        high: 415.98,
        low: 415.93,
        aveVolWeightedPrice: 415.9495,
        time: "08:35",
        symbol: "TSLA",
        volume: 7490184,
        ts: 1734701724000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 416.08,
        high: 416.08,
        low: 415.6906,
        aveVolWeightedPrice: 416.034,
        time: "08:35",
        symbol: "TSLA",
        volume: 7498371,
        ts: 1734701725000,
      },
      {
        type: "TXN",
        open: 415.98,
        close: 416.1365,
        high: 416.37,
        low: 415.98,
        aveVolWeightedPrice: 416.0917,
        time: "08:35",
        symbol: "TSLA",
        volume: 7502047,
        ts: 1734701726000,
      },
      {
        type: "TXN",
        open: 416.17,
        close: 416.14,
        high: 416.17,
        low: 416.14,
        aveVolWeightedPrice: 416.2238,
        time: "08:35",
        symbol: "TSLA",
        volume: 7503556,
        ts: 1734701727000,
      },
      {
        type: "TXN",
        open: 416.43,
        close: 416.43,
        high: 416.43,
        low: 416.43,
        aveVolWeightedPrice: 416.3373,
        time: "08:35",
        symbol: "TSLA",
        volume: 7503811,
        ts: 1734701728000,
      },
      {
        type: "TXN",
        open: 416.25,
        close: 416.25,
        high: 416.25,
        low: 416.25,
        aveVolWeightedPrice: 416.2483,
        time: "08:35",
        symbol: "TSLA",
        volume: 7504836,
        ts: 1734701730000,
      },
      {
        type: "TXN",
        open: 416.1224,
        close: 416.1224,
        high: 416.1224,
        low: 416.1224,
        aveVolWeightedPrice: 416.2735,
        time: "08:35",
        symbol: "TSLA",
        volume: 7505455,
        ts: 1734701731000,
      },
      {
        type: "TXN",
        open: 416.38,
        close: 416.46,
        high: 416.46,
        low: 416.38,
        aveVolWeightedPrice: 416.4186,
        time: "08:35",
        symbol: "TSLA",
        volume: 7506531,
        ts: 1734701732000,
      },
      {
        type: "TXN",
        open: 416.2,
        close: 416.46,
        high: 416.46,
        low: 416.2,
        aveVolWeightedPrice: 416.3397,
        time: "08:35",
        symbol: "TSLA",
        volume: 7507169,
        ts: 1734701733000,
      },
      {
        type: "TXN",
        open: 416.48,
        close: 416.92,
        high: 416.92,
        low: 416.48,
        aveVolWeightedPrice: 416.6096,
        time: "08:35",
        symbol: "TSLA",
        volume: 7509207,
        ts: 1734701734000,
      },
      {
        type: "TXN",
        open: 416.85,
        close: 416.88,
        high: 416.92,
        low: 416.5262,
        aveVolWeightedPrice: 416.8572,
        time: "08:35",
        symbol: "TSLA",
        volume: 7510468,
        ts: 1734701735000,
      },
      {
        type: "TXN",
        open: 416.87,
        close: 416.91,
        high: 416.92,
        low: 416.87,
        aveVolWeightedPrice: 416.8954,
        time: "08:35",
        symbol: "TSLA",
        volume: 7513953,
        ts: 1734701736000,
      },
      {
        type: "TXN",
        open: 416.93,
        close: 416.56,
        high: 416.93,
        low: 416.56,
        aveVolWeightedPrice: 416.8854,
        time: "08:35",
        symbol: "TSLA",
        volume: 7515367,
        ts: 1734701737000,
      },
      {
        type: "TXN",
        open: 416.9696,
        close: 416.9699,
        high: 416.97,
        low: 416.841,
        aveVolWeightedPrice: 416.9224,
        time: "08:35",
        symbol: "TSLA",
        volume: 7516350,
        ts: 1734701738000,
      },
      {
        type: "TXN",
        open: 416.94,
        close: 416.85,
        high: 416,
        low: 416.85,
        aveVolWeightedPrice: 416.9517,
        time: "08:35",
        symbol: "TSLA",
        volume: 7518044,
        ts: 1734701739000,
      },
      {
        type: "TXN",
        open: 416.93,
        close: 416,
        high: 416,
        low: 416.93,
        aveVolWeightedPrice: 416.9786,
        time: "08:35",
        symbol: "TSLA",
        volume: 7520172,
        ts: 1734701740000,
      },
      {
        type: "TXN",
        open: 416.09,
        close: 416.02,
        high: 416.13,
        low: 416.0001,
        aveVolWeightedPrice: 416.0431,
        time: "08:35",
        symbol: "TSLA",
        volume: 7521175,
        ts: 1734701741500,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.13,
        high: 416.13,
        low: 416,
        aveVolWeightedPrice: 416.0276,
        time: "08:35",
        symbol: "TSLA",
        volume: 7522940,
        ts: 1734701742000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.92,
        high: 416.1209,
        low: 416.92,
        aveVolWeightedPrice: 416.0096,
        time: "08:35",
        symbol: "TSLA",
        volume: 7524620,
        ts: 1734701743000,
      },
      {
        type: "TXN",
        open: 416.85,
        close: 416.9999,
        high: 416.9999,
        low: 416.76,
        aveVolWeightedPrice: 416.8381,
        time: "08:35",
        symbol: "TSLA",
        volume: 7525969,
        ts: 1734701744000,
      },
      {
        type: "TXN",
        open: 416.8,
        close: 416,
        high: 416,
        low: 416.8,
        aveVolWeightedPrice: 416.8437,
        time: "08:35",
        symbol: "TSLA",
        volume: 7526752,
        ts: 1734701745000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416,
        high: 416,
        low: 416,
        aveVolWeightedPrice: 416.9793,
        time: "08:35",
        symbol: "TSLA",
        volume: 7527681,
        ts: 1734701746000,
      },
      {
        type: "TXN",
        open: 416.89,
        close: 416.89,
        high: 416.89,
        low: 416.89,
        aveVolWeightedPrice: 416.881,
        time: "08:35",
        symbol: "TSLA",
        volume: 7528136,
        ts: 1734701747000,
      },
      {
        type: "TXN",
        open: 416.9,
        close: 416.9,
        high: 416.9,
        low: 416.9,
        aveVolWeightedPrice: 416.7572,
        time: "08:35",
        symbol: "TSLA",
        volume: 7528553,
        ts: 1734701749000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.97,
        high: 416,
        low: 416.775,
        aveVolWeightedPrice: 416.9226,
        time: "08:35",
        symbol: "TSLA",
        volume: 7530215,
        ts: 1734701750000,
      },
      {
        type: "TXN",
        open: 416.74,
        close: 416.7354,
        high: 416.98,
        low: 416.7354,
        aveVolWeightedPrice: 416.7927,
        time: "08:35",
        symbol: "TSLA",
        volume: 7531579,
        ts: 1734701751000,
      },
      {
        type: "TXN",
        open: 416.93,
        close: 416.98,
        high: 416.98,
        low: 416.93,
        aveVolWeightedPrice: 416.9634,
        time: "08:35",
        symbol: "TSLA",
        volume: 7533704,
        ts: 1734701752000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.23,
        high: 416.23,
        low: 416.98,
        aveVolWeightedPrice: 416.0378,
        time: "08:35",
        symbol: "TSLA",
        volume: 7536977,
        ts: 1734701753000,
      },
      {
        type: "TXN",
        open: 416.93,
        close: 416.15,
        high: 416.15,
        low: 416.93,
        aveVolWeightedPrice: 416.0917,
        time: "08:35",
        symbol: "TSLA",
        volume: 7537838,
        ts: 1734701754000,
      },
      {
        type: "TXN",
        open: 416.06,
        close: 416.24,
        high: 416.25,
        low: 416.06,
        aveVolWeightedPrice: 416.1867,
        time: "08:35",
        symbol: "TSLA",
        volume: 7539407,
        ts: 1734701755000,
      },
      {
        type: "TXN",
        open: 416.39,
        close: 416.3201,
        high: 416.5,
        low: 416.3201,
        aveVolWeightedPrice: 416.4341,
        time: "08:36",
        symbol: "TSLA",
        volume: 7547557,
        ts: 1734701761000,
      },
      {
        type: "TXN",
        open: 416.5,
        close: 416.63,
        high: 416.63,
        low: 416.5,
        aveVolWeightedPrice: 416.5352,
        time: "08:36",
        symbol: "TSLA",
        volume: 7552018,
        ts: 1734701762000,
      },
      {
        type: "TXN",
        open: 416.7074,
        close: 416.7074,
        high: 416.7074,
        low: 416.7074,
        aveVolWeightedPrice: 416.6584,
        time: "08:36",
        symbol: "TSLA",
        volume: 7552652,
        ts: 1734701763000,
      },
      {
        type: "TXN",
        open: 416.73,
        close: 416.59,
        high: 416.73,
        low: 416.59,
        aveVolWeightedPrice: 416.6707,
        time: "08:36",
        symbol: "TSLA",
        volume: 7553221,
        ts: 1734701764000,
      },
      {
        type: "TXN",
        open: 416.71,
        close: 416.6,
        high: 416.71,
        low: 416.59,
        aveVolWeightedPrice: 416.5972,
        time: "08:36",
        symbol: "TSLA",
        volume: 7554536,
        ts: 1734701766000,
      },
      {
        type: "TXN",
        open: 416.52,
        close: 416.46,
        high: 416.54,
        low: 416.46,
        aveVolWeightedPrice: 416.4879,
        time: "08:36",
        symbol: "TSLA",
        volume: 7557133,
        ts: 1734701767000,
      },
      {
        type: "TXN",
        open: 416.71,
        close: 416.71,
        high: 416.71,
        low: 416.71,
        aveVolWeightedPrice: 416.6523,
        time: "08:36",
        symbol: "TSLA",
        volume: 7557507,
        ts: 1734701768000,
      },
      {
        type: "TXN",
        open: 416.58,
        close: 416.7,
        high: 416.7,
        low: 416.58,
        aveVolWeightedPrice: 416.6597,
        time: "08:36",
        symbol: "TSLA",
        volume: 7558258,
        ts: 1734701769000,
      },
      {
        type: "TXN",
        open: 416.6789,
        close: 416.6789,
        high: 416.6789,
        low: 416.6789,
        aveVolWeightedPrice: 416.6506,
        time: "08:36",
        symbol: "TSLA",
        volume: 7559235,
        ts: 1734701771000,
      },
      {
        type: "TXN",
        open: 416.6,
        close: 416.59,
        high: 416.6,
        low: 416.52,
        aveVolWeightedPrice: 416.5452,
        time: "08:36",
        symbol: "TSLA",
        volume: 7561054,
        ts: 1734701772000,
      },
      {
        type: "TXN",
        open: 416.52,
        close: 416.0001,
        high: 416.56,
        low: 416,
        aveVolWeightedPrice: 416.2125,
        time: "08:36",
        symbol: "TSLA",
        volume: 7570700,
        ts: 1734701773000,
      },
      {
        type: "TXN",
        open: 416.2467,
        close: 416,
        high: 416.2467,
        low: 416,
        aveVolWeightedPrice: 416.0494,
        time: "08:36",
        symbol: "TSLA",
        volume: 7572660,
        ts: 1734701774000,
      },
      {
        type: "TXN",
        open: 416,
        close: 416.8,
        high: 416,
        low: 416.74,
        aveVolWeightedPrice: 416.8661,
        time: "08:36",
        symbol: "TSLA",
        volume: 7576557,
        ts: 1734701775000,
      },
      {
        type: "TXN",
        open: 416.97,
        close: 416,
        high: 416.08,
        low: 416.97,
        aveVolWeightedPrice: 416.0138,
        time: "08:36",
        symbol: "TSLA",
        volume: 7579128,
        ts: 1734701776000,
      },
      {
        type: "TXN",
        open: 416.02,
        close: 416.18,
        high: 416.18,
        low: 416.0011,
        aveVolWeightedPrice: 416.1341,
        time: "08:36",
        symbol: "TSLA",
        volume: 7580634,
        ts: 1734701777000,
      },
      {
        type: "TXN",
        open: 416.0058,
        close: 416.5,
        high: 416.5,
        low: 416.0058,
        aveVolWeightedPrice: 416.2051,
        time: "08:36",
        symbol: "TSLA",
        volume: 7582641,
        ts: 1734701778000,
      },
      {
        type: "TXN",
        open: 416.6403,
        close: 416.49,
        high: 416.6403,
        low: 416.38,
        aveVolWeightedPrice: 416.4963,
        time: "08:36",
        symbol: "TSLA",
        volume: 7583784,
        ts: 1734701779000,
      },
      {
        type: "TXN",
        open: 416.38,
        close: 416.71,
        high: 416.71,
        low: 416.38,
        aveVolWeightedPrice: 416.5938,
        time: "08:36",
        symbol: "TSLA",
        volume: 7587043,
        ts: 1734701780000,
      },
      {
        type: "TXN",
        open: 416.54,
        close: 416.54,
        high: 416.7,
        low: 416.54,
        aveVolWeightedPrice: 416.5882,
        time: "08:36",
        symbol: "TSLA",
        volume: 7587891,
        ts: 1734701781000,
      },
      {
        type: "TXN",
        open: 416.5567,
        close: 416.5567,
        high: 416.5567,
        low: 416.5567,
        aveVolWeightedPrice: 416.6074,
        time: "08:36",
        symbol: "TSLA",
        volume: 7588582,
        ts: 1734701783000,
      },
      {
        type: "TXN",
        open: 416.73,
        close: 416.6247,
        high: 416.73,
        low: 416.6247,
        aveVolWeightedPrice: 416.6806,
        time: "08:36",
        symbol: "TSLA",
        volume: 7589718,
        ts: 1734701784000,
      },
      {
        type: "TXN",
        open: 416.72,
        close: 416.6415,
        high: 416.72,
        low: 416.6415,
        aveVolWeightedPrice: 416.6632,
        time: "08:36",
        symbol: "TSLA",
        volume: 7590770,
        ts: 1734701785000,
      },
      {
        type: "TXN",
        open: 416.7,
        close: 416.11,
        high: 416.12,
        low: 416.64,
        aveVolWeightedPrice: 416.9542,
        time: "08:36",
        symbol: "TSLA",
        volume: 7611093,
        ts: 1734701786000,
      },
      {
        type: "TXN",
        open: 416.12,
        close: 416.3598,
        high: 416.4,
        low: 416.12,
        aveVolWeightedPrice: 416.2674,
        time: "08:36",
        symbol: "TSLA",
        volume: 7613202,
        ts: 1734701787000,
      },
      {
        type: "TXN",
        open: 416.341,
        close: 416.24,
        high: 416.341,
        low: 416.23,
        aveVolWeightedPrice: 416.2423,
        time: "08:36",
        symbol: "TSLA",
        volume: 7614784,
        ts: 1734701788000,
      },
      {
        type: "TXN",
        open: 416.24,
        close: 416.03,
        high: 416.24,
        low: 416.03,
        aveVolWeightedPrice: 416.1147,
        time: "08:36",
        symbol: "TSLA",
        volume: 7617557,
        ts: 1734701789000,
      },
      {
        type: "TXN",
        open: 416.03,
        close: 416.14,
        high: 416.22,
        low: 416.03,
        aveVolWeightedPrice: 416.1572,
        time: "08:36",
        symbol: "TSLA",
        volume: 7621485,
        ts: 1734701790000,
      },
      {
        type: "TXN",
        open: 416.11,
        close: 416.02,
        high: 416.11,
        low: 416.02,
        aveVolWeightedPrice: 416.088,
        time: "08:36",
        symbol: "TSLA",
        volume: 7624028,
        ts: 1734701791000,
      },
    ],
  };
};
